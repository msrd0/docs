<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Source of the Rust file `/root/.cargo/registry/src/github.com-1ecc6299db9ec823/document-features-0.2.7/lib.rs`."><meta name="keywords" content="rust, rustlang, rust-lang"><title>lib.rs - source</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../../normalize.css"><link rel="stylesheet" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../../ayu.css" disabled><link rel="stylesheet" href="../../dark.css" disabled><link rel="stylesheet" href="../../light.css" id="themeStyle"><script id="default-settings" 
        data-theme="ayu"
        data-use_system_theme="false"></script><script src="../../storage.js"></script><script defer src="../../source-script.js"></script><script defer src="../../source-files.js"></script><script defer src="../../main.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc source"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"></nav><main><div class="width-limiter"><nav class="sub"><a class="sub-logo-container" href="../../document_features/index.html"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></a><form class="search-form"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../wheel.svg"></a></div></form></nav><section id="main-content" class="content"><div class="example-wrap"><pre class="src-line-numbers"><span id="1">1</span>
<span id="2">2</span>
<span id="3">3</span>
<span id="4">4</span>
<span id="5">5</span>
<span id="6">6</span>
<span id="7">7</span>
<span id="8">8</span>
<span id="9">9</span>
<span id="10">10</span>
<span id="11">11</span>
<span id="12">12</span>
<span id="13">13</span>
<span id="14">14</span>
<span id="15">15</span>
<span id="16">16</span>
<span id="17">17</span>
<span id="18">18</span>
<span id="19">19</span>
<span id="20">20</span>
<span id="21">21</span>
<span id="22">22</span>
<span id="23">23</span>
<span id="24">24</span>
<span id="25">25</span>
<span id="26">26</span>
<span id="27">27</span>
<span id="28">28</span>
<span id="29">29</span>
<span id="30">30</span>
<span id="31">31</span>
<span id="32">32</span>
<span id="33">33</span>
<span id="34">34</span>
<span id="35">35</span>
<span id="36">36</span>
<span id="37">37</span>
<span id="38">38</span>
<span id="39">39</span>
<span id="40">40</span>
<span id="41">41</span>
<span id="42">42</span>
<span id="43">43</span>
<span id="44">44</span>
<span id="45">45</span>
<span id="46">46</span>
<span id="47">47</span>
<span id="48">48</span>
<span id="49">49</span>
<span id="50">50</span>
<span id="51">51</span>
<span id="52">52</span>
<span id="53">53</span>
<span id="54">54</span>
<span id="55">55</span>
<span id="56">56</span>
<span id="57">57</span>
<span id="58">58</span>
<span id="59">59</span>
<span id="60">60</span>
<span id="61">61</span>
<span id="62">62</span>
<span id="63">63</span>
<span id="64">64</span>
<span id="65">65</span>
<span id="66">66</span>
<span id="67">67</span>
<span id="68">68</span>
<span id="69">69</span>
<span id="70">70</span>
<span id="71">71</span>
<span id="72">72</span>
<span id="73">73</span>
<span id="74">74</span>
<span id="75">75</span>
<span id="76">76</span>
<span id="77">77</span>
<span id="78">78</span>
<span id="79">79</span>
<span id="80">80</span>
<span id="81">81</span>
<span id="82">82</span>
<span id="83">83</span>
<span id="84">84</span>
<span id="85">85</span>
<span id="86">86</span>
<span id="87">87</span>
<span id="88">88</span>
<span id="89">89</span>
<span id="90">90</span>
<span id="91">91</span>
<span id="92">92</span>
<span id="93">93</span>
<span id="94">94</span>
<span id="95">95</span>
<span id="96">96</span>
<span id="97">97</span>
<span id="98">98</span>
<span id="99">99</span>
<span id="100">100</span>
<span id="101">101</span>
<span id="102">102</span>
<span id="103">103</span>
<span id="104">104</span>
<span id="105">105</span>
<span id="106">106</span>
<span id="107">107</span>
<span id="108">108</span>
<span id="109">109</span>
<span id="110">110</span>
<span id="111">111</span>
<span id="112">112</span>
<span id="113">113</span>
<span id="114">114</span>
<span id="115">115</span>
<span id="116">116</span>
<span id="117">117</span>
<span id="118">118</span>
<span id="119">119</span>
<span id="120">120</span>
<span id="121">121</span>
<span id="122">122</span>
<span id="123">123</span>
<span id="124">124</span>
<span id="125">125</span>
<span id="126">126</span>
<span id="127">127</span>
<span id="128">128</span>
<span id="129">129</span>
<span id="130">130</span>
<span id="131">131</span>
<span id="132">132</span>
<span id="133">133</span>
<span id="134">134</span>
<span id="135">135</span>
<span id="136">136</span>
<span id="137">137</span>
<span id="138">138</span>
<span id="139">139</span>
<span id="140">140</span>
<span id="141">141</span>
<span id="142">142</span>
<span id="143">143</span>
<span id="144">144</span>
<span id="145">145</span>
<span id="146">146</span>
<span id="147">147</span>
<span id="148">148</span>
<span id="149">149</span>
<span id="150">150</span>
<span id="151">151</span>
<span id="152">152</span>
<span id="153">153</span>
<span id="154">154</span>
<span id="155">155</span>
<span id="156">156</span>
<span id="157">157</span>
<span id="158">158</span>
<span id="159">159</span>
<span id="160">160</span>
<span id="161">161</span>
<span id="162">162</span>
<span id="163">163</span>
<span id="164">164</span>
<span id="165">165</span>
<span id="166">166</span>
<span id="167">167</span>
<span id="168">168</span>
<span id="169">169</span>
<span id="170">170</span>
<span id="171">171</span>
<span id="172">172</span>
<span id="173">173</span>
<span id="174">174</span>
<span id="175">175</span>
<span id="176">176</span>
<span id="177">177</span>
<span id="178">178</span>
<span id="179">179</span>
<span id="180">180</span>
<span id="181">181</span>
<span id="182">182</span>
<span id="183">183</span>
<span id="184">184</span>
<span id="185">185</span>
<span id="186">186</span>
<span id="187">187</span>
<span id="188">188</span>
<span id="189">189</span>
<span id="190">190</span>
<span id="191">191</span>
<span id="192">192</span>
<span id="193">193</span>
<span id="194">194</span>
<span id="195">195</span>
<span id="196">196</span>
<span id="197">197</span>
<span id="198">198</span>
<span id="199">199</span>
<span id="200">200</span>
<span id="201">201</span>
<span id="202">202</span>
<span id="203">203</span>
<span id="204">204</span>
<span id="205">205</span>
<span id="206">206</span>
<span id="207">207</span>
<span id="208">208</span>
<span id="209">209</span>
<span id="210">210</span>
<span id="211">211</span>
<span id="212">212</span>
<span id="213">213</span>
<span id="214">214</span>
<span id="215">215</span>
<span id="216">216</span>
<span id="217">217</span>
<span id="218">218</span>
<span id="219">219</span>
<span id="220">220</span>
<span id="221">221</span>
<span id="222">222</span>
<span id="223">223</span>
<span id="224">224</span>
<span id="225">225</span>
<span id="226">226</span>
<span id="227">227</span>
<span id="228">228</span>
<span id="229">229</span>
<span id="230">230</span>
<span id="231">231</span>
<span id="232">232</span>
<span id="233">233</span>
<span id="234">234</span>
<span id="235">235</span>
<span id="236">236</span>
<span id="237">237</span>
<span id="238">238</span>
<span id="239">239</span>
<span id="240">240</span>
<span id="241">241</span>
<span id="242">242</span>
<span id="243">243</span>
<span id="244">244</span>
<span id="245">245</span>
<span id="246">246</span>
<span id="247">247</span>
<span id="248">248</span>
<span id="249">249</span>
<span id="250">250</span>
<span id="251">251</span>
<span id="252">252</span>
<span id="253">253</span>
<span id="254">254</span>
<span id="255">255</span>
<span id="256">256</span>
<span id="257">257</span>
<span id="258">258</span>
<span id="259">259</span>
<span id="260">260</span>
<span id="261">261</span>
<span id="262">262</span>
<span id="263">263</span>
<span id="264">264</span>
<span id="265">265</span>
<span id="266">266</span>
<span id="267">267</span>
<span id="268">268</span>
<span id="269">269</span>
<span id="270">270</span>
<span id="271">271</span>
<span id="272">272</span>
<span id="273">273</span>
<span id="274">274</span>
<span id="275">275</span>
<span id="276">276</span>
<span id="277">277</span>
<span id="278">278</span>
<span id="279">279</span>
<span id="280">280</span>
<span id="281">281</span>
<span id="282">282</span>
<span id="283">283</span>
<span id="284">284</span>
<span id="285">285</span>
<span id="286">286</span>
<span id="287">287</span>
<span id="288">288</span>
<span id="289">289</span>
<span id="290">290</span>
<span id="291">291</span>
<span id="292">292</span>
<span id="293">293</span>
<span id="294">294</span>
<span id="295">295</span>
<span id="296">296</span>
<span id="297">297</span>
<span id="298">298</span>
<span id="299">299</span>
<span id="300">300</span>
<span id="301">301</span>
<span id="302">302</span>
<span id="303">303</span>
<span id="304">304</span>
<span id="305">305</span>
<span id="306">306</span>
<span id="307">307</span>
<span id="308">308</span>
<span id="309">309</span>
<span id="310">310</span>
<span id="311">311</span>
<span id="312">312</span>
<span id="313">313</span>
<span id="314">314</span>
<span id="315">315</span>
<span id="316">316</span>
<span id="317">317</span>
<span id="318">318</span>
<span id="319">319</span>
<span id="320">320</span>
<span id="321">321</span>
<span id="322">322</span>
<span id="323">323</span>
<span id="324">324</span>
<span id="325">325</span>
<span id="326">326</span>
<span id="327">327</span>
<span id="328">328</span>
<span id="329">329</span>
<span id="330">330</span>
<span id="331">331</span>
<span id="332">332</span>
<span id="333">333</span>
<span id="334">334</span>
<span id="335">335</span>
<span id="336">336</span>
<span id="337">337</span>
<span id="338">338</span>
<span id="339">339</span>
<span id="340">340</span>
<span id="341">341</span>
<span id="342">342</span>
<span id="343">343</span>
<span id="344">344</span>
<span id="345">345</span>
<span id="346">346</span>
<span id="347">347</span>
<span id="348">348</span>
<span id="349">349</span>
<span id="350">350</span>
<span id="351">351</span>
<span id="352">352</span>
<span id="353">353</span>
<span id="354">354</span>
<span id="355">355</span>
<span id="356">356</span>
<span id="357">357</span>
<span id="358">358</span>
<span id="359">359</span>
<span id="360">360</span>
<span id="361">361</span>
<span id="362">362</span>
<span id="363">363</span>
<span id="364">364</span>
<span id="365">365</span>
<span id="366">366</span>
<span id="367">367</span>
<span id="368">368</span>
<span id="369">369</span>
<span id="370">370</span>
<span id="371">371</span>
<span id="372">372</span>
<span id="373">373</span>
<span id="374">374</span>
<span id="375">375</span>
<span id="376">376</span>
<span id="377">377</span>
<span id="378">378</span>
<span id="379">379</span>
<span id="380">380</span>
<span id="381">381</span>
<span id="382">382</span>
<span id="383">383</span>
<span id="384">384</span>
<span id="385">385</span>
<span id="386">386</span>
<span id="387">387</span>
<span id="388">388</span>
<span id="389">389</span>
<span id="390">390</span>
<span id="391">391</span>
<span id="392">392</span>
<span id="393">393</span>
<span id="394">394</span>
<span id="395">395</span>
<span id="396">396</span>
<span id="397">397</span>
<span id="398">398</span>
<span id="399">399</span>
<span id="400">400</span>
<span id="401">401</span>
<span id="402">402</span>
<span id="403">403</span>
<span id="404">404</span>
<span id="405">405</span>
<span id="406">406</span>
<span id="407">407</span>
<span id="408">408</span>
<span id="409">409</span>
<span id="410">410</span>
<span id="411">411</span>
<span id="412">412</span>
<span id="413">413</span>
<span id="414">414</span>
<span id="415">415</span>
<span id="416">416</span>
<span id="417">417</span>
<span id="418">418</span>
<span id="419">419</span>
<span id="420">420</span>
<span id="421">421</span>
<span id="422">422</span>
<span id="423">423</span>
<span id="424">424</span>
<span id="425">425</span>
<span id="426">426</span>
<span id="427">427</span>
<span id="428">428</span>
<span id="429">429</span>
<span id="430">430</span>
<span id="431">431</span>
<span id="432">432</span>
<span id="433">433</span>
<span id="434">434</span>
<span id="435">435</span>
<span id="436">436</span>
<span id="437">437</span>
<span id="438">438</span>
<span id="439">439</span>
<span id="440">440</span>
<span id="441">441</span>
<span id="442">442</span>
<span id="443">443</span>
<span id="444">444</span>
<span id="445">445</span>
<span id="446">446</span>
<span id="447">447</span>
<span id="448">448</span>
<span id="449">449</span>
<span id="450">450</span>
<span id="451">451</span>
<span id="452">452</span>
<span id="453">453</span>
<span id="454">454</span>
<span id="455">455</span>
<span id="456">456</span>
<span id="457">457</span>
<span id="458">458</span>
<span id="459">459</span>
<span id="460">460</span>
<span id="461">461</span>
<span id="462">462</span>
<span id="463">463</span>
<span id="464">464</span>
<span id="465">465</span>
<span id="466">466</span>
<span id="467">467</span>
<span id="468">468</span>
<span id="469">469</span>
<span id="470">470</span>
<span id="471">471</span>
<span id="472">472</span>
<span id="473">473</span>
<span id="474">474</span>
<span id="475">475</span>
<span id="476">476</span>
<span id="477">477</span>
<span id="478">478</span>
<span id="479">479</span>
<span id="480">480</span>
<span id="481">481</span>
<span id="482">482</span>
<span id="483">483</span>
<span id="484">484</span>
<span id="485">485</span>
<span id="486">486</span>
<span id="487">487</span>
<span id="488">488</span>
<span id="489">489</span>
<span id="490">490</span>
<span id="491">491</span>
<span id="492">492</span>
<span id="493">493</span>
<span id="494">494</span>
<span id="495">495</span>
<span id="496">496</span>
<span id="497">497</span>
<span id="498">498</span>
<span id="499">499</span>
<span id="500">500</span>
<span id="501">501</span>
<span id="502">502</span>
<span id="503">503</span>
<span id="504">504</span>
<span id="505">505</span>
<span id="506">506</span>
<span id="507">507</span>
<span id="508">508</span>
<span id="509">509</span>
<span id="510">510</span>
<span id="511">511</span>
<span id="512">512</span>
<span id="513">513</span>
<span id="514">514</span>
<span id="515">515</span>
<span id="516">516</span>
<span id="517">517</span>
<span id="518">518</span>
<span id="519">519</span>
<span id="520">520</span>
<span id="521">521</span>
<span id="522">522</span>
<span id="523">523</span>
<span id="524">524</span>
<span id="525">525</span>
<span id="526">526</span>
<span id="527">527</span>
<span id="528">528</span>
<span id="529">529</span>
<span id="530">530</span>
<span id="531">531</span>
<span id="532">532</span>
<span id="533">533</span>
<span id="534">534</span>
<span id="535">535</span>
<span id="536">536</span>
<span id="537">537</span>
<span id="538">538</span>
<span id="539">539</span>
<span id="540">540</span>
<span id="541">541</span>
<span id="542">542</span>
<span id="543">543</span>
<span id="544">544</span>
<span id="545">545</span>
<span id="546">546</span>
<span id="547">547</span>
<span id="548">548</span>
<span id="549">549</span>
<span id="550">550</span>
<span id="551">551</span>
<span id="552">552</span>
<span id="553">553</span>
<span id="554">554</span>
<span id="555">555</span>
<span id="556">556</span>
<span id="557">557</span>
<span id="558">558</span>
<span id="559">559</span>
<span id="560">560</span>
<span id="561">561</span>
<span id="562">562</span>
<span id="563">563</span>
<span id="564">564</span>
<span id="565">565</span>
<span id="566">566</span>
<span id="567">567</span>
<span id="568">568</span>
<span id="569">569</span>
<span id="570">570</span>
<span id="571">571</span>
<span id="572">572</span>
<span id="573">573</span>
<span id="574">574</span>
<span id="575">575</span>
<span id="576">576</span>
<span id="577">577</span>
<span id="578">578</span>
<span id="579">579</span>
<span id="580">580</span>
<span id="581">581</span>
<span id="582">582</span>
<span id="583">583</span>
<span id="584">584</span>
<span id="585">585</span>
<span id="586">586</span>
<span id="587">587</span>
<span id="588">588</span>
<span id="589">589</span>
<span id="590">590</span>
<span id="591">591</span>
<span id="592">592</span>
<span id="593">593</span>
<span id="594">594</span>
<span id="595">595</span>
<span id="596">596</span>
<span id="597">597</span>
<span id="598">598</span>
<span id="599">599</span>
<span id="600">600</span>
<span id="601">601</span>
<span id="602">602</span>
<span id="603">603</span>
<span id="604">604</span>
<span id="605">605</span>
<span id="606">606</span>
<span id="607">607</span>
<span id="608">608</span>
<span id="609">609</span>
<span id="610">610</span>
<span id="611">611</span>
<span id="612">612</span>
<span id="613">613</span>
<span id="614">614</span>
<span id="615">615</span>
<span id="616">616</span>
<span id="617">617</span>
<span id="618">618</span>
<span id="619">619</span>
<span id="620">620</span>
<span id="621">621</span>
<span id="622">622</span>
<span id="623">623</span>
<span id="624">624</span>
<span id="625">625</span>
<span id="626">626</span>
<span id="627">627</span>
<span id="628">628</span>
<span id="629">629</span>
<span id="630">630</span>
<span id="631">631</span>
<span id="632">632</span>
<span id="633">633</span>
<span id="634">634</span>
<span id="635">635</span>
<span id="636">636</span>
<span id="637">637</span>
<span id="638">638</span>
<span id="639">639</span>
<span id="640">640</span>
<span id="641">641</span>
<span id="642">642</span>
<span id="643">643</span>
<span id="644">644</span>
<span id="645">645</span>
<span id="646">646</span>
<span id="647">647</span>
<span id="648">648</span>
<span id="649">649</span>
<span id="650">650</span>
<span id="651">651</span>
<span id="652">652</span>
<span id="653">653</span>
<span id="654">654</span>
<span id="655">655</span>
<span id="656">656</span>
<span id="657">657</span>
<span id="658">658</span>
<span id="659">659</span>
<span id="660">660</span>
<span id="661">661</span>
<span id="662">662</span>
<span id="663">663</span>
<span id="664">664</span>
<span id="665">665</span>
<span id="666">666</span>
<span id="667">667</span>
<span id="668">668</span>
<span id="669">669</span>
<span id="670">670</span>
<span id="671">671</span>
<span id="672">672</span>
<span id="673">673</span>
<span id="674">674</span>
<span id="675">675</span>
<span id="676">676</span>
<span id="677">677</span>
<span id="678">678</span>
<span id="679">679</span>
<span id="680">680</span>
<span id="681">681</span>
<span id="682">682</span>
<span id="683">683</span>
<span id="684">684</span>
<span id="685">685</span>
<span id="686">686</span>
<span id="687">687</span>
<span id="688">688</span>
<span id="689">689</span>
<span id="690">690</span>
<span id="691">691</span>
<span id="692">692</span>
<span id="693">693</span>
<span id="694">694</span>
<span id="695">695</span>
<span id="696">696</span>
<span id="697">697</span>
<span id="698">698</span>
<span id="699">699</span>
<span id="700">700</span>
<span id="701">701</span>
<span id="702">702</span>
<span id="703">703</span>
<span id="704">704</span>
<span id="705">705</span>
<span id="706">706</span>
<span id="707">707</span>
<span id="708">708</span>
<span id="709">709</span>
<span id="710">710</span>
<span id="711">711</span>
<span id="712">712</span>
<span id="713">713</span>
<span id="714">714</span>
<span id="715">715</span>
<span id="716">716</span>
<span id="717">717</span>
<span id="718">718</span>
<span id="719">719</span>
<span id="720">720</span>
<span id="721">721</span>
<span id="722">722</span>
<span id="723">723</span>
<span id="724">724</span>
<span id="725">725</span>
<span id="726">726</span>
<span id="727">727</span>
<span id="728">728</span>
<span id="729">729</span>
<span id="730">730</span>
<span id="731">731</span>
<span id="732">732</span>
<span id="733">733</span>
<span id="734">734</span>
<span id="735">735</span>
<span id="736">736</span>
<span id="737">737</span>
<span id="738">738</span>
<span id="739">739</span>
<span id="740">740</span>
<span id="741">741</span>
<span id="742">742</span>
<span id="743">743</span>
<span id="744">744</span>
<span id="745">745</span>
<span id="746">746</span>
<span id="747">747</span>
<span id="748">748</span>
<span id="749">749</span>
<span id="750">750</span>
<span id="751">751</span>
<span id="752">752</span>
<span id="753">753</span>
<span id="754">754</span>
<span id="755">755</span>
<span id="756">756</span>
<span id="757">757</span>
<span id="758">758</span>
<span id="759">759</span>
<span id="760">760</span>
<span id="761">761</span>
<span id="762">762</span>
<span id="763">763</span>
<span id="764">764</span>
<span id="765">765</span>
<span id="766">766</span>
<span id="767">767</span>
<span id="768">768</span>
<span id="769">769</span>
<span id="770">770</span>
<span id="771">771</span>
<span id="772">772</span>
<span id="773">773</span>
<span id="774">774</span>
<span id="775">775</span>
<span id="776">776</span>
<span id="777">777</span>
<span id="778">778</span>
<span id="779">779</span>
<span id="780">780</span>
<span id="781">781</span>
<span id="782">782</span>
<span id="783">783</span>
<span id="784">784</span>
<span id="785">785</span>
<span id="786">786</span>
<span id="787">787</span>
<span id="788">788</span>
<span id="789">789</span>
<span id="790">790</span>
<span id="791">791</span>
<span id="792">792</span>
<span id="793">793</span>
<span id="794">794</span>
<span id="795">795</span>
<span id="796">796</span>
<span id="797">797</span>
<span id="798">798</span>
<span id="799">799</span>
<span id="800">800</span>
<span id="801">801</span>
<span id="802">802</span>
<span id="803">803</span>
<span id="804">804</span>
<span id="805">805</span>
<span id="806">806</span>
<span id="807">807</span>
<span id="808">808</span>
<span id="809">809</span>
<span id="810">810</span>
<span id="811">811</span>
<span id="812">812</span>
<span id="813">813</span>
<span id="814">814</span>
<span id="815">815</span>
<span id="816">816</span>
<span id="817">817</span>
<span id="818">818</span>
<span id="819">819</span>
<span id="820">820</span>
<span id="821">821</span>
<span id="822">822</span>
<span id="823">823</span>
<span id="824">824</span>
<span id="825">825</span>
<span id="826">826</span>
<span id="827">827</span>
<span id="828">828</span>
<span id="829">829</span>
<span id="830">830</span>
<span id="831">831</span>
<span id="832">832</span>
<span id="833">833</span>
<span id="834">834</span>
<span id="835">835</span>
<span id="836">836</span>
<span id="837">837</span>
<span id="838">838</span>
<span id="839">839</span>
<span id="840">840</span>
<span id="841">841</span>
<span id="842">842</span>
<span id="843">843</span>
<span id="844">844</span>
<span id="845">845</span>
<span id="846">846</span>
<span id="847">847</span>
<span id="848">848</span>
<span id="849">849</span>
<span id="850">850</span>
<span id="851">851</span>
<span id="852">852</span>
<span id="853">853</span>
<span id="854">854</span>
<span id="855">855</span>
<span id="856">856</span>
<span id="857">857</span>
<span id="858">858</span>
<span id="859">859</span>
<span id="860">860</span>
<span id="861">861</span>
<span id="862">862</span>
<span id="863">863</span>
<span id="864">864</span>
<span id="865">865</span>
<span id="866">866</span>
<span id="867">867</span>
<span id="868">868</span>
<span id="869">869</span>
<span id="870">870</span>
<span id="871">871</span>
<span id="872">872</span>
<span id="873">873</span>
<span id="874">874</span>
<span id="875">875</span>
<span id="876">876</span>
<span id="877">877</span>
<span id="878">878</span>
<span id="879">879</span>
<span id="880">880</span>
</pre><pre class="rust"><code><span class="comment">// Copyright © SixtyFPS GmbH &lt;info@sixtyfps.io&gt;
// SPDX-License-Identifier: MIT OR Apache-2.0

</span><span class="doccomment">/*!
Document your crate&#39;s feature flags.

This crates provides a macro that extracts &quot;documentation&quot; comments from Cargo.toml

To use this crate, add `#![doc = document_features::document_features!()]` in your crate documentation.
The `document_features!()` macro reads your `Cargo.toml` file, extracts feature comments and generates
a markdown string for your documentation.

Basic example:

```rust
//! Normal crate documentation goes here.
//!
//! ## Feature flags
#![doc = document_features::document_features!()]

// rest of the crate goes here.
```

## Documentation format:

The documentation of your crate features goes into `Cargo.toml`, where they are defined.

The `document_features!()` macro analyzes the contents of `Cargo.toml`.
Similar to Rust&#39;s documentation comments `///` and `//!`, the macro understands
comments that start with `## ` and `#! `. Note the required trailing space.
Lines starting with `###` will not be understood as doc comment.

`## ` comments are meant to be *above* the feature they document.
There can be several `## ` comments, but they must always be followed by a
feature name or an optional dependency.
There should not be `#! ` comments between the comment and the feature they document.

`#! ` comments are not associated with a particular feature, and will be printed
in where they occur. Use them to group features, for example.

## Examples:

*/
</span><span class="comment">// Note: because rustdoc escapes the first `#` of a line starting with `#`,
// these docs comments have one more `#` ,
</span><span class="attribute">#![doc = <span class="macro">self_test!</span>(<span class="doccomment">/**
[package]
name = &quot;...&quot;
## ...

[features]
default = [&quot;foo&quot;]
##! This comments goes on top

### The foo feature enables the `foo` functions
foo = []

### The bar feature enables the bar module
bar = []

##! ### Experimental features
##! The following features are experimental

### Enable the fusion reactor
###
### ⚠️ Can lead to explosions
fusion = []

[dependencies]
document-features = &quot;0.2&quot;

##! ### Optional dependencies

### Enable this feature to implement the trait for the types from the genial crate
genial = { version = &quot;0.2&quot;, optional = true }

### This awesome dependency is specified in its own table
[dependencies.awesome]
version = &quot;1.3.5&quot;
optional = true
*/
</span>=&gt;
    <span class="doccomment">/**
This comments goes on top
* **`foo`** *(enabled by default)* —  The foo feature enables the `foo` functions

* **`bar`** —  The bar feature enables the bar module

#### Experimental features
The following features are experimental
* **`fusion`** —  Enable the fusion reactor

  ⚠️ Can lead to explosions

#### Optional dependencies
* **`genial`** —  Enable this feature to implement the trait for the types from the genial crate

* **`awesome`** —  This awesome dependency is specified in its own table

*/
</span>)]
</span><span class="doccomment">/*!

## Customization

You can customize the formatting of the features in the generated documentation by setting
the key **`feature_label=`** to a given format string. This format string must be either
a [string literal](https://doc.rust-lang.org/reference/tokens.html#string-literals) or
a [raw string literal](https://doc.rust-lang.org/reference/tokens.html#raw-string-literals).
Every occurrence of `{feature}` inside the format string will be substituted with the name of the feature.

For instance, to emulate the HTML formatting used by `rustdoc` one can use the following:

```rust
#![doc = document_features::document_features!(feature_label = r#&quot;&lt;span class=&quot;stab portability&quot;&gt;&lt;code&gt;{feature}&lt;/code&gt;&lt;/span&gt;&quot;#)]
```

The default formatting is equivalent to:

```rust
#![doc = document_features::document_features!(feature_label = &quot;**`{feature}`**&quot;)]
```

## Compatibility

The minimum Rust version required to use this crate is Rust 1.54 because of the
feature to have macro in doc comments. You can make this crate optional and use
`#[cfg_attr()]` statements to enable it only when building the documentation:
You need to have two levels of `cfg_attr` because Rust &lt; 1.54 doesn&#39;t parse the attribute
otherwise.

```rust,ignore
#![cfg_attr(
    feature = &quot;document-features&quot;,
    cfg_attr(doc, doc = ::document_features::document_features!())
)]
```

In your Cargo.toml, enable this feature while generating the documentation on docs.rs:

```toml
[dependencies]
document-features = { version = &quot;0.2&quot;, optional = true }

[package.metadata.docs.rs]
features = [&quot;document-features&quot;]
## Alternative: enable all features so they are all documented
## all-features = true
```
 */

</span><span class="attribute">#[cfg(not(feature = <span class="string">&quot;default&quot;</span>))]
</span><span class="macro">compile_error!</span>(
    <span class="string">&quot;The feature `default` must be enabled to ensure \
    forward compatibility with future version of this crate&quot;
</span>);

<span class="kw">extern crate </span>proc_macro;

<span class="kw">use </span>proc_macro::{TokenStream, TokenTree};
<span class="kw">use </span>std::borrow::Cow;
<span class="kw">use </span>std::collections::HashSet;
<span class="kw">use </span>std::convert::TryFrom;
<span class="kw">use </span>std::fmt::Write;
<span class="kw">use </span>std::path::Path;
<span class="kw">use </span>std::str::FromStr;

<span class="kw">fn </span>error(e: <span class="kw-2">&amp;</span>str) -&gt; TokenStream {
    TokenStream::from_str(<span class="kw-2">&amp;</span><span class="macro">format!</span>(<span class="string">&quot;::core::compile_error!{{\&quot;{}\&quot;}}&quot;</span>, e.escape_default())).unwrap()
}

<span class="kw">fn </span>compile_error(msg: <span class="kw-2">&amp;</span>str, tt: <span class="prelude-ty">Option</span>&lt;TokenTree&gt;) -&gt; TokenStream {
    <span class="kw">let </span>span = tt.as_ref().map_or_else(proc_macro::Span::call_site, TokenTree::span);
    <span class="kw">use </span>proc_macro::{Delimiter, Group, Ident, Literal, Punct, Spacing};
    <span class="kw">use </span>std::iter::FromIterator;
    TokenStream::from_iter(<span class="macro">vec!</span>[
        TokenTree::Ident(Ident::new(<span class="string">&quot;compile_error&quot;</span>, span)),
        TokenTree::Punct({
            <span class="kw">let </span><span class="kw-2">mut </span>punct = Punct::new(<span class="string">&#39;!&#39;</span>, Spacing::Alone);
            punct.set_span(span);
            punct
        }),
        TokenTree::Group({
            <span class="kw">let </span><span class="kw-2">mut </span>group = Group::new(Delimiter::Brace, {
                TokenStream::from_iter([TokenTree::Literal({
                    <span class="kw">let </span><span class="kw-2">mut </span>string = Literal::string(msg);
                    string.set_span(span);
                    string
                })])
            });
            group.set_span(span);
            group
        }),
    ])
}

<span class="attribute">#[derive(Default)]
</span><span class="kw">struct </span>Args {
    feature_label: <span class="prelude-ty">Option</span>&lt;String&gt;,
}

<span class="kw">fn </span>parse_args(input: TokenStream) -&gt; <span class="prelude-ty">Result</span>&lt;Args, TokenStream&gt; {
    <span class="kw">let </span><span class="kw-2">mut </span>token_trees = input.into_iter().fuse();

    <span class="comment">// parse the key, ensuring that it is the identifier `feature_label`
    </span><span class="kw">match </span>token_trees.next() {
        <span class="prelude-val">None </span>=&gt; <span class="kw">return </span><span class="prelude-val">Ok</span>(Args::default()),
        <span class="prelude-val">Some</span>(TokenTree::Ident(ident)) <span class="kw">if </span>ident.to_string() == <span class="string">&quot;feature_label&quot; </span>=&gt; (),
        tt =&gt; <span class="kw">return </span><span class="prelude-val">Err</span>(compile_error(<span class="string">&quot;expected `feature_label`&quot;</span>, tt)),
    }

    <span class="comment">// parse a single equal sign `=`
    </span><span class="kw">match </span>token_trees.next() {
        <span class="prelude-val">Some</span>(TokenTree::Punct(p)) <span class="kw">if </span>p.as_char() == <span class="string">&#39;=&#39; </span>=&gt; (),
        tt =&gt; <span class="kw">return </span><span class="prelude-val">Err</span>(compile_error(<span class="string">&quot;expected `=`&quot;</span>, tt)),
    }

    <span class="comment">// parse the value, ensuring that it is a string literal containing the substring `&quot;{feature}&quot;`
    </span><span class="kw">let </span>feature_label;
    <span class="kw">if let </span><span class="prelude-val">Some</span>(tt) = token_trees.next() {
        <span class="kw">match </span>litrs::StringLit::&lt;String&gt;::try_from(<span class="kw-2">&amp;</span>tt) {
            <span class="prelude-val">Ok</span>(string_lit) <span class="kw">if </span>string_lit.value().contains(<span class="string">&quot;{feature}&quot;</span>) =&gt; {
                feature_label = string_lit.value().to_string()
            }
            <span class="kw">_ </span>=&gt; {
                <span class="kw">return </span><span class="prelude-val">Err</span>(compile_error(
                    <span class="string">&quot;expected a string literal containing the substring \&quot;{feature}\&quot;&quot;</span>,
                    <span class="prelude-val">Some</span>(tt),
                ))
            }
        }
    } <span class="kw">else </span>{
        <span class="kw">return </span><span class="prelude-val">Err</span>(compile_error(
            <span class="string">&quot;expected a string literal containing the substring \&quot;{feature}\&quot;&quot;</span>,
            <span class="prelude-val">None</span>,
        ));
    }

    <span class="comment">// ensure there is nothing left after the format string
    </span><span class="kw">if let </span>tt @ <span class="prelude-val">Some</span>(<span class="kw">_</span>) = token_trees.next() {
        <span class="kw">return </span><span class="prelude-val">Err</span>(compile_error(<span class="string">&quot;unexpected token after the format string&quot;</span>, tt));
    }

    <span class="prelude-val">Ok</span>(Args { feature_label: <span class="prelude-val">Some</span>(feature_label) })
}

<span class="doccomment">/// Produce a literal string containing documentation extracted from Cargo.toml
///
/// See the [crate] documentation for details
</span><span class="attribute">#[proc_macro]
</span><span class="kw">pub fn </span>document_features(tokens: TokenStream) -&gt; TokenStream {
    parse_args(tokens)
        .and_then(|args| document_features_impl(<span class="kw-2">&amp;</span>args))
        .unwrap_or_else(std::convert::identity)
}

<span class="kw">fn </span>document_features_impl(args: <span class="kw-2">&amp;</span>Args) -&gt; <span class="prelude-ty">Result</span>&lt;TokenStream, TokenStream&gt; {
    <span class="kw">let </span>path = std::env::var(<span class="string">&quot;CARGO_MANIFEST_DIR&quot;</span>).unwrap();
    <span class="kw">let </span><span class="kw-2">mut </span>cargo_toml = std::fs::read_to_string(Path::new(<span class="kw-2">&amp;</span>path).join(<span class="string">&quot;Cargo.toml&quot;</span>))
        .map_err(|e| error(<span class="kw-2">&amp;</span><span class="macro">format!</span>(<span class="string">&quot;Can&#39;t open Cargo.toml: {:?}&quot;</span>, e)))<span class="question-mark">?</span>;

    <span class="kw">if </span>!cargo_toml.contains(<span class="string">&quot;\n##&quot;</span>) &amp;&amp; !cargo_toml.contains(<span class="string">&quot;\n#!&quot;</span>) {
        <span class="comment">// On crates.io, Cargo.toml is usually &quot;normalized&quot; and stripped of all comments.
        // The original Cargo.toml has been renamed Cargo.toml.orig
        </span><span class="kw">if let </span><span class="prelude-val">Ok</span>(orig) = std::fs::read_to_string(Path::new(<span class="kw-2">&amp;</span>path).join(<span class="string">&quot;Cargo.toml.orig&quot;</span>)) {
            <span class="kw">if </span>orig.contains(<span class="string">&quot;##&quot;</span>) || orig.contains(<span class="string">&quot;#!&quot;</span>) {
                cargo_toml = orig;
            }
        }
    }

    <span class="kw">let </span>result = process_toml(<span class="kw-2">&amp;</span>cargo_toml, args).map_err(|e| error(<span class="kw-2">&amp;</span>e))<span class="question-mark">?</span>;
    <span class="prelude-val">Ok</span>(std::iter::once(proc_macro::TokenTree::from(proc_macro::Literal::string(<span class="kw-2">&amp;</span>result))).collect())
}

<span class="kw">fn </span>process_toml(cargo_toml: <span class="kw-2">&amp;</span>str, args: <span class="kw-2">&amp;</span>Args) -&gt; <span class="prelude-ty">Result</span>&lt;String, String&gt; {
    <span class="comment">// Get all lines between the &quot;[features]&quot; and the next block
    </span><span class="kw">let </span><span class="kw-2">mut </span>lines = cargo_toml
        .lines()
        .map(str::trim)
        <span class="comment">// and skip empty lines and comments that are not docs comments
        </span>.filter(|l| {
            !l.is_empty() &amp;&amp; (!l.starts_with(<span class="string">&quot;#&quot;</span>) || l.starts_with(<span class="string">&quot;##&quot;</span>) || l.starts_with(<span class="string">&quot;#!&quot;</span>))
        });
    <span class="kw">let </span><span class="kw-2">mut </span>top_comment = String::new();
    <span class="kw">let </span><span class="kw-2">mut </span>current_comment = String::new();
    <span class="kw">let </span><span class="kw-2">mut </span>features = <span class="macro">vec!</span>[];
    <span class="kw">let </span><span class="kw-2">mut </span>default_features = HashSet::new();
    <span class="kw">let </span><span class="kw-2">mut </span>current_table = <span class="string">&quot;&quot;</span>;
    <span class="kw">while let </span><span class="prelude-val">Some</span>(line) = lines.next() {
        <span class="kw">if let </span><span class="prelude-val">Some</span>(x) = line.strip_prefix(<span class="string">&quot;#!&quot;</span>) {
            <span class="kw">if </span>!x.is_empty() &amp;&amp; !x.starts_with(<span class="string">&quot; &quot;</span>) {
                <span class="kw">continue</span>; <span class="comment">// it&#39;s not a doc comment
            </span>}
            <span class="kw">if </span>!current_comment.is_empty() {
                <span class="kw">return </span><span class="prelude-val">Err</span>(<span class="string">&quot;Cannot mix ## and #! comments between features.&quot;</span>.into());
            }
            <span class="macro">writeln!</span>(top_comment, <span class="string">&quot;{}&quot;</span>, x).unwrap();
        } <span class="kw">else if let </span><span class="prelude-val">Some</span>(x) = line.strip_prefix(<span class="string">&quot;##&quot;</span>) {
            <span class="kw">if </span>!x.is_empty() &amp;&amp; !x.starts_with(<span class="string">&quot; &quot;</span>) {
                <span class="kw">continue</span>; <span class="comment">// it&#39;s not a doc comment
            </span>}
            <span class="macro">writeln!</span>(current_comment, <span class="string">&quot; {}&quot;</span>, x).unwrap();
        } <span class="kw">else if let </span><span class="prelude-val">Some</span>(table) = line.strip_prefix(<span class="string">&quot;[&quot;</span>) {
            current_table = table
                .split_once(<span class="string">&quot;]&quot;</span>)
                .map(|(t, <span class="kw">_</span>)| t.trim())
                .ok_or_else(|| <span class="macro">format!</span>(<span class="string">&quot;Parse error while parsing line: {}&quot;</span>, line))<span class="question-mark">?</span>;
            <span class="kw">if </span>!current_comment.is_empty() {
                <span class="kw">let </span>dep = current_table
                    .rsplit_once(<span class="string">&quot;.&quot;</span>)
                    .and_then(|(table, dep)| table.trim().ends_with(<span class="string">&quot;dependencies&quot;</span>).then(|| dep))
                    .ok_or_else(|| <span class="macro">format!</span>(<span class="string">&quot;Not a feature: `{}`&quot;</span>, line))<span class="question-mark">?</span>;
                features.push((
                    dep.trim(),
                    std::mem::take(<span class="kw-2">&amp;mut </span>top_comment),
                    std::mem::take(<span class="kw-2">&amp;mut </span>current_comment),
                ));
            }
        } <span class="kw">else if let </span><span class="prelude-val">Some</span>((dep, rest)) = line.split_once(<span class="string">&quot;=&quot;</span>) {
            <span class="kw">let </span>dep = dep.trim().trim_matches(<span class="string">&#39;&quot;&#39;</span>);
            <span class="kw">let </span>rest = get_balanced(rest, <span class="kw-2">&amp;mut </span>lines)
                .map_err(|e| <span class="macro">format!</span>(<span class="string">&quot;Parse error while parsing value {}: {}&quot;</span>, dep, e))<span class="question-mark">?</span>;
            <span class="kw">if </span>current_table == <span class="string">&quot;features&quot; </span>&amp;&amp; dep == <span class="string">&quot;default&quot; </span>{
                <span class="kw">let </span>defaults = rest
                    .trim()
                    .strip_prefix(<span class="string">&quot;[&quot;</span>)
                    .and_then(|r| r.strip_suffix(<span class="string">&quot;]&quot;</span>))
                    .ok_or_else(|| <span class="macro">format!</span>(<span class="string">&quot;Parse error while parsing dependency {}&quot;</span>, dep))<span class="question-mark">?
                    </span>.split(<span class="string">&quot;,&quot;</span>)
                    .map(|d| d.trim().trim_matches(|c| c == <span class="string">&#39;&quot;&#39; </span>|| c == <span class="string">&#39;\&#39;&#39;</span>).trim().to_string())
                    .filter(|d| !d.is_empty());
                default_features.extend(defaults);
            }
            <span class="kw">if </span>!current_comment.is_empty() {
                <span class="kw">if </span>current_table.ends_with(<span class="string">&quot;dependencies&quot;</span>) {
                    <span class="kw">if </span>!rest
                        .split_once(<span class="string">&quot;optional&quot;</span>)
                        .and_then(|(<span class="kw">_</span>, r)| r.trim().strip_prefix(<span class="string">&quot;=&quot;</span>))
                        .map_or(<span class="bool-val">false</span>, |r| r.trim().starts_with(<span class="string">&quot;true&quot;</span>))
                    {
                        <span class="kw">return </span><span class="prelude-val">Err</span>(<span class="macro">format!</span>(<span class="string">&quot;Dependency {} is not an optional dependency&quot;</span>, dep));
                    }
                } <span class="kw">else if </span>current_table != <span class="string">&quot;features&quot; </span>{
                    <span class="kw">return </span><span class="prelude-val">Err</span>(<span class="macro">format!</span>(
                        <span class="string">&quot;Comment cannot be associated with a feature:{}&quot;</span>,
                        current_comment
                    ));
                }
                features.push((
                    dep,
                    std::mem::take(<span class="kw-2">&amp;mut </span>top_comment),
                    std::mem::take(<span class="kw-2">&amp;mut </span>current_comment),
                ));
            }
        }
    }
    <span class="kw">if </span>!current_comment.is_empty() {
        <span class="kw">return </span><span class="prelude-val">Err</span>(<span class="string">&quot;Found comment not associated with a feature&quot;</span>.into());
    }
    <span class="kw">if </span>features.is_empty() {
        <span class="kw">return </span><span class="prelude-val">Err</span>(<span class="string">&quot;Could not find documented features in Cargo.toml&quot;</span>.into());
    }
    <span class="kw">let </span><span class="kw-2">mut </span>result = String::new();
    <span class="kw">for </span>(f, top, comment) <span class="kw">in </span>features {
        <span class="kw">let </span>default = <span class="kw">if </span>default_features.contains(f) { <span class="string">&quot; *(enabled by default)*&quot; </span>} <span class="kw">else </span>{ <span class="string">&quot;&quot; </span>};
        <span class="kw">if </span>!comment.trim().is_empty() {
            <span class="kw">if let </span><span class="prelude-val">Some</span>(feature_label) = <span class="kw-2">&amp;</span>args.feature_label {
                <span class="macro">writeln!</span>(
                    result,
                    <span class="string">&quot;{}* {}{} —{}&quot;</span>,
                    top,
                    feature_label.replace(<span class="string">&quot;{feature}&quot;</span>, f),
                    default,
                    comment
                )
                .unwrap();
            } <span class="kw">else </span>{
                <span class="macro">writeln!</span>(result, <span class="string">&quot;{}* **`{}`**{} —{}&quot;</span>, top, f, default, comment).unwrap();
            }
        } <span class="kw">else </span>{
            <span class="kw">if let </span><span class="prelude-val">Some</span>(feature_label) = <span class="kw-2">&amp;</span>args.feature_label {
                <span class="macro">writeln!</span>(
                    result,
                    <span class="string">&quot;{}* {}{}\n&quot;</span>,
                    top,
                    feature_label.replace(<span class="string">&quot;{feature}&quot;</span>, f),
                    default,
                )
                .unwrap();
            } <span class="kw">else </span>{
                <span class="macro">writeln!</span>(result, <span class="string">&quot;{}* **`{}`**{}\n&quot;</span>, top, f, default).unwrap();
            }
        }
    }
    result += <span class="kw-2">&amp;</span>top_comment;
    <span class="prelude-val">Ok</span>(result)
}

<span class="kw">fn </span>get_balanced&lt;<span class="lifetime">&#39;a</span>&gt;(
    first_line: <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>str,
    lines: <span class="kw-2">&amp;mut </span><span class="kw">impl </span>Iterator&lt;Item = <span class="kw-2">&amp;</span><span class="lifetime">&#39;a </span>str&gt;,
) -&gt; <span class="prelude-ty">Result</span>&lt;Cow&lt;<span class="lifetime">&#39;a</span>, str&gt;, String&gt; {
    <span class="kw">let </span><span class="kw-2">mut </span>line = first_line;
    <span class="kw">let </span><span class="kw-2">mut </span>result = Cow::from(<span class="string">&quot;&quot;</span>);

    <span class="kw">let </span><span class="kw-2">mut </span>in_quote = <span class="bool-val">false</span>;
    <span class="kw">let </span><span class="kw-2">mut </span>level = <span class="number">0</span>;
    <span class="kw">loop </span>{
        <span class="kw">let </span><span class="kw-2">mut </span>last_slash = <span class="bool-val">false</span>;
        <span class="kw">for </span>(idx, b) <span class="kw">in </span>line.as_bytes().into_iter().enumerate() {
            <span class="kw">if </span>last_slash {
                last_slash = <span class="bool-val">false
            </span>} <span class="kw">else if </span>in_quote {
                <span class="kw">match </span>b {
                    <span class="string">b&#39;\\&#39; </span>=&gt; last_slash = <span class="bool-val">true</span>,
                    <span class="string">b&#39;&quot;&#39; </span>| <span class="string">b&#39;\&#39;&#39; </span>=&gt; in_quote = <span class="bool-val">false</span>,
                    <span class="kw">_ </span>=&gt; (),
                }
            } <span class="kw">else </span>{
                <span class="kw">match </span>b {
                    <span class="string">b&#39;\\&#39; </span>=&gt; last_slash = <span class="bool-val">true</span>,
                    <span class="string">b&#39;&quot;&#39; </span>=&gt; in_quote = <span class="bool-val">true</span>,
                    <span class="string">b&#39;{&#39; </span>| <span class="string">b&#39;[&#39; </span>=&gt; level += <span class="number">1</span>,
                    <span class="string">b&#39;}&#39; </span>| <span class="string">b&#39;]&#39; </span><span class="kw">if </span>level == <span class="number">0 </span>=&gt; <span class="kw">return </span><span class="prelude-val">Err</span>(<span class="string">&quot;unbalanced source&quot;</span>.into()),
                    <span class="string">b&#39;}&#39; </span>| <span class="string">b&#39;]&#39; </span>=&gt; level -= <span class="number">1</span>,
                    <span class="string">b&#39;#&#39; </span>=&gt; {
                        line = <span class="kw-2">&amp;</span>line[..idx];
                        <span class="kw">break</span>;
                    }
                    <span class="kw">_ </span>=&gt; (),
                }
            }
        }
        <span class="kw">if </span>result.len() == <span class="number">0 </span>{
            result = Cow::from(line);
        } <span class="kw">else </span>{
            <span class="kw-2">*</span>result.to_mut() += line;
        }
        <span class="kw">if </span>level == <span class="number">0 </span>{
            <span class="kw">return </span><span class="prelude-val">Ok</span>(result);
        }
        line = <span class="kw">if let </span><span class="prelude-val">Some</span>(l) = lines.next() {
            l
        } <span class="kw">else </span>{
            <span class="kw">return </span><span class="prelude-val">Err</span>(<span class="string">&quot;unbalanced source&quot;</span>.into());
        };
    }
}

<span class="attribute">#[test]
</span><span class="kw">fn </span>test_get_balanced() {
    <span class="macro">assert_eq!</span>(
        get_balanced(
            <span class="string">&quot;{&quot;</span>,
            <span class="kw-2">&amp;mut </span>IntoIterator::into_iter([<span class="string">&quot;a&quot;</span>, <span class="string">&quot;{ abc[], #ignore&quot;</span>, <span class="string">&quot; def }&quot;</span>, <span class="string">&quot;}&quot;</span>, <span class="string">&quot;xxx&quot;</span>])
        ),
        <span class="prelude-val">Ok</span>(<span class="string">&quot;{a{ abc[],  def }}&quot;</span>.into())
    );
    <span class="macro">assert_eq!</span>(
        get_balanced(<span class="string">&quot;{ foo = \&quot;{#\&quot; } #ignore&quot;</span>, <span class="kw-2">&amp;mut </span>IntoIterator::into_iter([<span class="string">&quot;xxx&quot;</span>])),
        <span class="prelude-val">Ok</span>(<span class="string">&quot;{ foo = \&quot;{#\&quot; } &quot;</span>.into())
    );
    <span class="macro">assert_eq!</span>(
        get_balanced(<span class="string">&quot;]&quot;</span>, <span class="kw-2">&amp;mut </span>IntoIterator::into_iter([<span class="string">&quot;[&quot;</span>])),
        <span class="prelude-val">Err</span>(<span class="string">&quot;unbalanced source&quot;</span>.into())
    );
}

<span class="attribute">#[cfg(feature = <span class="string">&quot;self-test&quot;</span>)]
#[proc_macro]
#[doc(hidden)]
</span><span class="doccomment">/// Helper macro for the tests. Do not use
</span><span class="kw">pub fn </span>self_test_helper(input: TokenStream) -&gt; TokenStream {
    process_toml((<span class="kw-2">&amp;</span>input).to_string().trim_matches(|c| c == <span class="string">&#39;&quot;&#39; </span>|| c == <span class="string">&#39;#&#39;</span>), <span class="kw-2">&amp;</span>Args::default())
        .map_or_else(
            |e| error(<span class="kw-2">&amp;</span>e),
            |r| {
                std::iter::once(proc_macro::TokenTree::from(proc_macro::Literal::string(<span class="kw-2">&amp;</span>r)))
                    .collect()
            },
        )
}

<span class="attribute">#[cfg(feature = <span class="string">&quot;self-test&quot;</span>)]
</span><span class="macro">macro_rules! </span>self_test {
    (<span class="attribute">#[doc = <span class="macro-nonterminal">$toml</span>:literal] </span>=&gt; <span class="attribute">#[doc = <span class="macro-nonterminal">$md</span>:literal]</span>) =&gt; {
        <span class="macro">concat!</span>(
            <span class="string">&quot;\n`````rust\n\
            fn normalize_md(md : &amp;str) -&gt; String {
               md.lines().skip_while(|l| l.is_empty()).map(|l| l.trim())
                .collect::&lt;Vec&lt;_&gt;&gt;().join(\&quot;\\n\&quot;)
            }
            assert_eq!(normalize_md(document_features::self_test_helper!(&quot;</span>,
            <span class="macro">stringify!</span>(<span class="macro-nonterminal">$toml</span>),
            <span class="string">&quot;)), normalize_md(&quot;</span>,
            <span class="macro">stringify!</span>(<span class="macro-nonterminal">$md</span>),
            <span class="string">&quot;));\n`````\n\n&quot;
        </span>)
    };
}

<span class="attribute">#[cfg(not(feature = <span class="string">&quot;self-test&quot;</span>))]
</span><span class="macro">macro_rules! </span>self_test {
    (<span class="attribute">#[doc = <span class="macro-nonterminal">$toml</span>:literal] </span>=&gt; <span class="attribute">#[doc = <span class="macro-nonterminal">$md</span>:literal]</span>) =&gt; {
        <span class="macro">concat!</span>(
            <span class="string">&quot;This contents in Cargo.toml:\n`````toml&quot;</span>,
            <span class="macro-nonterminal">$toml</span>,
            <span class="string">&quot;\n`````\n Generates the following:\n\
            &lt;table&gt;&lt;tr&gt;&lt;th&gt;Preview&lt;/th&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;\n\n&quot;</span>,
            <span class="macro-nonterminal">$md</span>,
            <span class="string">&quot;\n&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\n\n&amp;nbsp;\n&quot;</span>,
        )
    };
}

<span class="comment">// The following struct is inserted only during generation of the documentation in order to exploit doc-tests.
// These doc-tests are used to check that invalid arguments to the `document_features!` macro cause a compile time error.
// For a more principled way of testing compilation error, maybe investigate &lt;https://docs.rs/trybuild&gt;.
//
</span><span class="doccomment">/// ```rust
/// #![doc = document_features::document_features!()]
/// #![doc = document_features::document_features!(feature_label = &quot;**`{feature}`**&quot;)]
/// #![doc = document_features::document_features!(feature_label = r&quot;**`{feature}`**&quot;)]
/// #![doc = document_features::document_features!(feature_label = r#&quot;**`{feature}`**&quot;#)]
/// #![doc = document_features::document_features!(feature_label = &quot;&lt;span class=\&quot;stab portability\&quot;&gt;&lt;code&gt;{feature}&lt;/code&gt;&lt;/span&gt;&quot;)]
/// #![doc = document_features::document_features!(feature_label = r#&quot;&lt;span class=&quot;stab portability&quot;&gt;&lt;code&gt;{feature}&lt;/code&gt;&lt;/span&gt;&quot;#)]
/// ```
/// ```compile_fail
/// #![doc = document_features::document_features!(feature_label &gt; &quot;&lt;span&gt;{feature}&lt;/span&gt;&quot;)]
/// ```
/// ```compile_fail
/// #![doc = document_features::document_features!(label = &quot;&lt;span&gt;{feature}&lt;/span&gt;&quot;)]
/// ```
/// ```compile_fail
/// #![doc = document_features::document_features!(feature_label = &quot;{feat}&quot;)]
/// ```
/// ```compile_fail
/// #![doc = document_features::document_features!(feature_label = 3.14)]
/// ```
/// ```compile_fail
/// #![doc = document_features::document_features!(feature_label = )]
/// ```
/// ```compile_fail
/// #![doc = document_features::document_features!(feature_label = &quot;**`{feature}`**&quot; extra)]
/// ```
</span><span class="attribute">#[cfg(doc)]
</span><span class="kw">struct </span>FeatureLabelCompilationTest;

<span class="attribute">#[cfg(test)]
</span><span class="kw">mod </span>tests {
    <span class="kw">use super</span>::{process_toml, Args};

    <span class="attribute">#[track_caller]
    </span><span class="kw">fn </span>test_error(toml: <span class="kw-2">&amp;</span>str, expected: <span class="kw-2">&amp;</span>str) {
        <span class="kw">let </span>err = process_toml(toml, <span class="kw-2">&amp;</span>Args::default()).unwrap_err();
        <span class="macro">assert!</span>(err.contains(expected), <span class="string">&quot;{:?} does not contain {:?}&quot;</span>, err, expected)
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>only_get_balanced_in_correct_table() {
        process_toml(
            <span class="string">r#&quot;

[package.metadata.release]
pre-release-replacements = [
  {test=\&quot;\#\# \&quot;},
]
[abcd]
[features]#xyz
#! abc
#
###
#! def
#!
## 123
## 456
feat1 = [&quot;plop&quot;]
#! ghi
no_doc = []
##
feat2 = [&quot;momo&quot;]
#! klm
default = [&quot;feat1&quot;, &quot;something_else&quot;]
#! end
            &quot;#</span>,
            <span class="kw-2">&amp;</span>Args::default(),
        )
        .unwrap();
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>parse_error1() {
        test_error(
            <span class="string">r#&quot;
[features]
[dependencies]
foo = 4;
&quot;#</span>,
            <span class="string">&quot;Could not find documented features&quot;</span>,
        );
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>parse_error2() {
        test_error(
            <span class="string">r#&quot;
[packages]
[dependencies]
&quot;#</span>,
            <span class="string">&quot;Could not find documented features&quot;</span>,
        );
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>parse_error3() {
        test_error(
            <span class="string">r#&quot;
[features]
ff = []
[abcd
efgh
[dependencies]
&quot;#</span>,
            <span class="string">&quot;Parse error while parsing line: [abcd&quot;</span>,
        );
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>parse_error4() {
        test_error(
            <span class="string">r#&quot;
[features]
## dd
## ff
#! ee
## ff
&quot;#</span>,
            <span class="string">&quot;Cannot mix&quot;</span>,
        );
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>parse_error5() {
        test_error(
            <span class="string">r#&quot;
[features]
## dd
&quot;#</span>,
            <span class="string">&quot;not associated with a feature&quot;</span>,
        );
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>parse_error6() {
        test_error(
            <span class="string">r#&quot;
[features]
# ff
foo = []
default = [
#ffff
# ff
&quot;#</span>,
            <span class="string">&quot;Parse error while parsing value default&quot;</span>,
        );
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>parse_error7() {
        test_error(
            <span class="string">r#&quot;
[features]
# f
foo = [ x = { ]
bar = []
&quot;#</span>,
            <span class="string">&quot;Parse error while parsing value foo&quot;</span>,
        );
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>not_a_feature1() {
        test_error(
            <span class="string">r#&quot;
## hallo
[features]
&quot;#</span>,
            <span class="string">&quot;Not a feature: `[features]`&quot;</span>,
        );
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>not_a_feature2() {
        test_error(
            <span class="string">r#&quot;
[package]
## hallo
foo = []
&quot;#</span>,
            <span class="string">&quot;Comment cannot be associated with a feature:  hallo&quot;</span>,
        );
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>non_optional_dep1() {
        test_error(
            <span class="string">r#&quot;
[dev-dependencies]
## Not optional
foo = { version = &quot;1.2&quot;, optional = false }
&quot;#</span>,
            <span class="string">&quot;Dependency foo is not an optional dependency&quot;</span>,
        );
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>non_optional_dep2() {
        test_error(
            <span class="string">r#&quot;
[dev-dependencies]
## Not optional
foo = { version = &quot;1.2&quot; }
&quot;#</span>,
            <span class="string">&quot;Dependency foo is not an optional dependency&quot;</span>,
        );
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>basic() {
        <span class="kw">let </span>toml = <span class="string">r#&quot;
[abcd]
[features]#xyz
#! abc
#
###
#! def
#!
## 123
## 456
feat1 = [&quot;plop&quot;]
#! ghi
no_doc = []
##
feat2 = [&quot;momo&quot;]
#! klm
default = [&quot;feat1&quot;, &quot;something_else&quot;]
#! end
        &quot;#</span>;
        <span class="kw">let </span>parsed = process_toml(toml, <span class="kw-2">&amp;</span>Args::default()).unwrap();
        <span class="macro">assert_eq!</span>(
            parsed,
            <span class="string">&quot; abc\n def\n\n* **`feat1`** *(enabled by default)* —  123\n  456\n\n ghi\n* **`feat2`**\n\n klm\n end\n&quot;
        </span>);
        <span class="kw">let </span>parsed = process_toml(
            toml,
            <span class="kw-2">&amp;</span>Args {
                feature_label: <span class="prelude-val">Some</span>(
                    <span class="string">&quot;&lt;span class=\&quot;stab portability\&quot;&gt;&lt;code&gt;{feature}&lt;/code&gt;&lt;/span&gt;&quot;</span>.into(),
                ),
            },
        )
        .unwrap();
        <span class="macro">assert_eq!</span>(
            parsed,
            <span class="string">&quot; abc\n def\n\n* &lt;span class=\&quot;stab portability\&quot;&gt;&lt;code&gt;feat1&lt;/code&gt;&lt;/span&gt; *(enabled by default)* —  123\n  456\n\n ghi\n* &lt;span class=\&quot;stab portability\&quot;&gt;&lt;code&gt;feat2&lt;/code&gt;&lt;/span&gt;\n\n klm\n end\n&quot;
        </span>);
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>dependencies() {
        <span class="kw">let </span>toml = <span class="string">r#&quot;
#! top
[dev-dependencies] #yo
## dep1
dep1 = { version=&quot;1.2&quot;, optional=true}
#! yo
dep2 = &quot;1.3&quot;
## dep3
[target.&#39;cfg(unix)&#39;.build-dependencies.dep3]
version = &quot;42&quot;
optional = true
        &quot;#</span>;
        <span class="kw">let </span>parsed = process_toml(toml, <span class="kw-2">&amp;</span>Args::default()).unwrap();
        <span class="macro">assert_eq!</span>(parsed, <span class="string">&quot; top\n* **`dep1`** —  dep1\n\n yo\n* **`dep3`** —  dep3\n\n&quot;</span>);
        <span class="kw">let </span>parsed = process_toml(
            toml,
            <span class="kw-2">&amp;</span>Args {
                feature_label: <span class="prelude-val">Some</span>(
                    <span class="string">&quot;&lt;span class=\&quot;stab portability\&quot;&gt;&lt;code&gt;{feature}&lt;/code&gt;&lt;/span&gt;&quot;</span>.into(),
                ),
            },
        )
        .unwrap();
        <span class="macro">assert_eq!</span>(parsed, <span class="string">&quot; top\n* &lt;span class=\&quot;stab portability\&quot;&gt;&lt;code&gt;dep1&lt;/code&gt;&lt;/span&gt; —  dep1\n\n yo\n* &lt;span class=\&quot;stab portability\&quot;&gt;&lt;code&gt;dep3&lt;/code&gt;&lt;/span&gt; —  dep3\n\n&quot;</span>);
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>multi_lines() {
        <span class="kw">let </span>toml = <span class="string">r#&quot;
[package.metadata.foo]
ixyz = [
    [&quot;array&quot;],
    [
        &quot;of&quot;,
        &quot;arrays&quot;
    ]
]
[dev-dependencies]
## dep1
dep1 = {
    version=&quot;1.2-}&quot;,
    optional=true
}
[features]
default = [
    &quot;goo&quot;,
    &quot;\&quot;]&quot;,
    &quot;bar&quot;,
]
## foo
foo = [
   &quot;bar&quot;
]
## bar
bar = [

]
        &quot;#</span>;
        <span class="kw">let </span>parsed = process_toml(toml, <span class="kw-2">&amp;</span>Args::default()).unwrap();
        <span class="macro">assert_eq!</span>(
            parsed,
            <span class="string">&quot;* **`dep1`** —  dep1\n\n* **`foo`** —  foo\n\n* **`bar`** *(enabled by default)* —  bar\n\n&quot;
        </span>);
        <span class="kw">let </span>parsed = process_toml(
            toml,
            <span class="kw-2">&amp;</span>Args {
                feature_label: <span class="prelude-val">Some</span>(
                    <span class="string">&quot;&lt;span class=\&quot;stab portability\&quot;&gt;&lt;code&gt;{feature}&lt;/code&gt;&lt;/span&gt;&quot;</span>.into(),
                ),
            },
        )
        .unwrap();
        <span class="macro">assert_eq!</span>(
            parsed,
            <span class="string">&quot;* &lt;span class=\&quot;stab portability\&quot;&gt;&lt;code&gt;dep1&lt;/code&gt;&lt;/span&gt; —  dep1\n\n* &lt;span class=\&quot;stab portability\&quot;&gt;&lt;code&gt;foo&lt;/code&gt;&lt;/span&gt; —  foo\n\n* &lt;span class=\&quot;stab portability\&quot;&gt;&lt;code&gt;bar&lt;/code&gt;&lt;/span&gt; *(enabled by default)* —  bar\n\n&quot;
        </span>);
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>dots_in_feature() {
        <span class="kw">let </span>toml = <span class="string">r#&quot;
[features]
## This is a test
&quot;teßt.&quot; = []
default = [&quot;teßt.&quot;]
[dependencies]
## A dep
&quot;dep&quot; = { version = &quot;123&quot;, optional = true }
        &quot;#</span>;
        <span class="kw">let </span>parsed = process_toml(toml, <span class="kw-2">&amp;</span>Args::default()).unwrap();
        <span class="macro">assert_eq!</span>(
            parsed,
            <span class="string">&quot;* **`teßt.`** *(enabled by default)* —  This is a test\n\n* **`dep`** —  A dep\n\n&quot;
        </span>);
        <span class="kw">let </span>parsed = process_toml(
            toml,
            <span class="kw-2">&amp;</span>Args {
                feature_label: <span class="prelude-val">Some</span>(
                    <span class="string">&quot;&lt;span class=\&quot;stab portability\&quot;&gt;&lt;code&gt;{feature}&lt;/code&gt;&lt;/span&gt;&quot;</span>.into(),
                ),
            },
        )
        .unwrap();
        <span class="macro">assert_eq!</span>(
            parsed,
            <span class="string">&quot;* &lt;span class=\&quot;stab portability\&quot;&gt;&lt;code&gt;teßt.&lt;/code&gt;&lt;/span&gt; *(enabled by default)* —  This is a test\n\n* &lt;span class=\&quot;stab portability\&quot;&gt;&lt;code&gt;dep&lt;/code&gt;&lt;/span&gt; —  A dep\n\n&quot;
        </span>);
    }
}
</code></pre></div>
</section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="document_features" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.66.1 (90743e729 2023-01-10) (Arch Linux rust 1:1.66.1-2)" ></div></body></html>